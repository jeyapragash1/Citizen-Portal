{% extends "base.html" %}
{% block content %}
<div class="auth-wrapper">
  <div class="auth-card">
    <h2 class="auth-title">Welcome back</h2>
    <p class="text-muted">Sign in to your account.</p>
    <form id="loginForm" class="auth-form">
      <label>Email <span class="required-asterisk">*</span>
        <input type="email" name="email" required placeholder="you@example.com">
      </label>

      <label>Password <span class="required-asterisk">*</span>
        <input type="password" name="password" required placeholder="Your password">
      </label>

      <button type="submit" class="primary-btn">Login</button>
    </form>

    <div class="result-output">
      <pre id="result" aria-live="polite"></pre>
    </div>

    <div class="auth-footer text-center">
      <small>Don't have an account? <a href="/register">Register</a></small>
    </div>
  </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = e.target;
  const data = {email: f.email.value, password: f.password.value};
  const res = await fetch('/api/user/login', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)});
  const j = await res.json();
  const out = document.getElementById('result');
  out.textContent = JSON.stringify(j, null, 2);
  if (j && j.status === 'ok') {
    out.parentElement.classList.add('result-success');
    out.parentElement.classList.remove('result-error');
    // On successful login, redirect to the portal index
    window.location.href = '/index';
  } else {
    out.parentElement.classList.add('result-error');
    out.parentElement.classList.remove('result-success');
  }
});
</script>
{% endblock %}
